# frozen_string_literal: true

require 'rails_helper'

RSpec.describe ExhibitsSearchService do
  subject(:service) { described_class.new }

  let(:response) do
    <<~JSON
      [{"id":46,"title":"!Women Art Revolution","subtitle":"Voices of a Movement","slug":"women-art-revolution","description":"The artists’ and critics’ interviews presented here chronicle the founding years of the feminist art movement in the 1970s.  Created by artist and filmmaker Lynn Hershman Leeson as she developed her groundbreaking documentary, !Women Art Revolution, this archive provides the first-person histories of the pioneering individuals who challenged the ways in which women were considered by the reigning art establishment.","created_at":"2016-08-05T17:46:06.000-07:00","updated_at":"2025-03-13T10:19:31.000-07:00","layout":null,"published":true,"published_at":null,"featured_image":null,"masthead_id":669,"thumbnail_id":670,"weight":110,"site_id":1,"theme":null,"tag_list":["Arts \u0026 Humanities","Social justice"],"facets":null,"thumbnail_url":"https://exhibits.stanford.edu/images/670/31,22,462,462/400,400/0/default.jpg"},{"id":186,"title":"Coordinates: Maps and Art Exploring Shared Terrain","subtitle":null,"slug":"coordinates-test","description":"Featuring how maps and art overlap in explorations of space - both geographical and metaphorical - this exhibition took place at Stanford's David Rumsey Map Center from April 25th to September 30th, 2019, and was co-curated by Emily Prince and David Rumsey.","created_at":"2019-08-28T13:52:23.000-07:00","updated_at":"2025-06-06T08:55:06.000-07:00","layout":null,"published":true,"published_at":null,"featured_image":null,"masthead_id":5710,"thumbnail_id":5819,"weight":163,"site_id":1,"theme":"default","tag_list":["Maps \u0026 Geography","Arts \u0026 Humanities"],"facets":null,"thumbnail_url":"https://exhibits.stanford.edu/images/5818/67,96,2146,2149/400,400/0/default.jpg"},{"id":211,"title":"James E. Allen - Artist, Illustrator, Printmaker","subtitle":"A catalog of his works","slug":"james-e-allen","description":"James E. Allen had a 40 year career as an printmaker and illustrator, and was one of the first artists in the early 20th century whose commercial works crossed over to fine arts. This catalog includes information about known works from all aspects of his career.","created_at":"2020-06-01T17:28:18.000-07:00","updated_at":"2025-05-06T17:15:42.000-07:00","layout":null,"published":true,"published_at":null,"featured_image":null,"masthead_id":6421,"thumbnail_id":6758,"weight":69,"site_id":1,"theme":null,"tag_list":["Arts \u0026 Humanities"],"facets":null,"thumbnail_url":"https://exhibits.stanford.edu/images/6758/32,43,630,630/400,400/0/default.jpg"},{"id":136,"title":"Arthur Tress Photograph Collection","subtitle":"A Stanford Libraries Special Collections Exhibition","slug":"tress","description":"One of the most renowned and innovative photographers of his generation, Arthur Tress explores a world that is rich with implication and fantasy. Continually seeking what he refers to as “the hidden life of the imagination,” Tress embraces accident and chance, creating beautifully composed works that can be both playful and ominous. In 2016 Stanford Libraries received the first in a continuing series of installments that will form the Arthur Tress photography archive.","created_at":"2018-06-21T16:49:52.000-07:00","updated_at":"2025-03-13T10:19:31.000-07:00","layout":null,"published":true,"published_at":null,"featured_image":null,"masthead_id":3726,"thumbnail_id":3719,"weight":171,"site_id":1,"theme":"default","tag_list":["Arts \u0026 Humanities"],"facets":null,"thumbnail_url":"https://stacks.stanford.edu/image/iiif/cb498gp1973%2Fcb498gp1973_00_0001/336,912,4419,4419/400,400/0/default.jpg"},{"id":48,"title":"The History of Artificial Intelligence","subtitle":null,"slug":"ai","description":"Stanford's library collections document the history of artificial intelligence captured on film, video and audio.","created_at":"2016-08-08T17:09:14.000-07:00","updated_at":"2025-03-13T10:19:31.000-07:00","layout":null,"published":true,"published_at":null,"featured_image":null,"masthead_id":664,"thumbnail_id":665,"weight":174,"site_id":1,"theme":null,"tag_list":["Science \u0026 Engineering"],"facets":null,"thumbnail_url":"https://exhibits.stanford.edu/images/665/198,0,608,608/400,400/0/default.jpg"},{"id":325,"title":"Ray Dolby","subtitle":"Inventor at the Intersection of Art \u0026 Technology","slug":"dolby","description":"Ray Dolby revolutionized the way we experience recorded music and sound. This exhibit showcases aspects of his life and work, offering a glimpse of the person behind the technology that made Dolby a household name.","created_at":"2024-10-03T16:27:27.000-07:00","updated_at":"2025-05-29T14:28:51.000-07:00","layout":null,"published":true,"published_at":null,"featured_image":null,"masthead_id":11781,"thumbnail_id":11779,"weight":0,"site_id":1,"theme":null,"tag_list":["Science \u0026 Engineering","Stanfordiana","Arts \u0026 Humanities"],"facets":null,"thumbnail_url":"https://exhibits.stanford.edu/images/11779-f71d026af540a30d158299a56f57a959/1260,85,4183,4183/400,400/0/default.jpg"},{"id":212,"title":"Cartographic Symbologies","subtitle":"The Art and Design of Expression in Historic Maps","slug":"cartosym","description":"An exhibit highlighting the symbologies, and other design elements, found within historic maps.","created_at":"2020-06-10T15:53:23.000-07:00","updated_at":"2025-05-14T15:16:35.000-07:00","layout":null,"published":true,"published_at":null,"featured_image":null,"masthead_id":6441,"thumbnail_id":6443,"weight":21,"site_id":1,"theme":null,"tag_list":["Maps \u0026 Geography"],"facets":null,"thumbnail_url":"https://stacks.stanford.edu/image/iiif/kv147kh9030%2Fkv147kh9030_00_0001/2117,2446,5800,5800/400,400/0/default.jpg"},{"id":18,"title":"The Edward A. Feigenbaum Papers","subtitle":"Work in artificial intelligence and computer science at Stanford University","slug":"feigenbaum","description":"The Edward A. Feigenbaum Papers collection primarily concerns his work in artificial intelligence at Stanford University and includes administrative files, correspondence, project files, trip files, proposals, reports, reprints, Artificial Intelligence Lab memos, audio tapes, video tapes, and files on computer programs, including EPAM, DENDRAL, MOLGEN, MYCIN, and others.","created_at":"2015-10-05T16:50:06.000-07:00","updated_at":"2025-03-13T10:19:31.000-07:00","layout":null,"published":true,"published_at":null,"featured_image":null,"masthead_id":64,"thumbnail_id":142,"weight":160,"site_id":1,"theme":null,"tag_list":["Science \u0026 Engineering"],"facets":null,"thumbnail_url":"https://exhibits.stanford.edu/images/142/546,210,2187,2187/400,400/0/default.jpg"}]
    JSON
  end
  let(:query) { ExhibitsSearchService::Request.new('my query') }

  before do
    stub_request(:get, /.*/).to_return(body: response)
  end

  it { expect(service).to be_an AbstractSearchService }
  it { expect(service.search(query)).to be_an ExhibitsSearchService::Response }

  describe '#records' do
    it 'returns the relevant metadata from the API' do
      results = service.search(query).results
      expect(results.length).to eq 3
      expect(results.first.title).to eq '!Women Art Revolution'
      expect(results.first.description).to eq 'Voices of a Movement'
      expect(results.first.link).to eq 'https://exhibits.stanford.edu/women-art-revolution'
      expect(results.first.thumbnail).to eq 'https://exhibits.stanford.edu/images/670/31,22,462,462/400,400/0/default.jpg'
    end
  end
end
