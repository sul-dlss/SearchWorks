<%= render partial: "catalog/stackmap_link", locals: { document: document, location: location, location_name_class: "location-name" } %>
<% if location.bound_with? && document.bound_with? %>
  <%= content_tag(:div, class: 'bound-with-note note-highlight') { render document.bound_with_note_for_access_panel } %>
<% else %>
  <span class="pull-right"><%= render location_request_link %></span>
<% end %>
<% if location.mhld.present? %>
  <% location.mhld.each do |mhld| %>
    <% if mhld.public_note.present? %>
      <div class='mhld'><%= mhld.public_note %></div>
    <% end %>
    <% if mhld.latest_received.present? %>
      <div class='mhld note-highlight'>Latest: <%= mhld.latest_received %></div>
    <% end %>
    <% if mhld.library_has.present? %>
      <div class='mhld'>Library has: <%= mhld.library_has %></div>
    <% end %>
  <% end %>
<% end %>
<table class='availability record-view'>
  <caption class="sr-only">Items in <%= location.name %></caption>
  <thead>
    <tr class="sr-only">
      <th scope="col">Call number</th>
      <th class="sr-only" scope="col">Note</th>
      <th scope="col">Status</th>
    </tr>
  </thead>
  <tbody data-long-list data-list-type="location">
    <% location.items.each do |item| %>
      <tr class="availability-item">
        <td class="callnumber">
          <%= item.callnumber %>
        </td>
        <td class="public-note">
          <% if item.public_note.present? %>
            <div class='public-note note-highlight'>Note: <%= inject_line_break_opportunities item.public_note %></div>
          <% end %>
        </td>
        <% if item.present? %>
          <td class="item-availability" data-live-lookup-id="<%= document.live_lookup_id %>" data-status-target=".availability-icon" data-item-id="<%= item.live_lookup_item_id if item.live_status? %>" <%= "data-request-url='#{helpers.request_url(document, library: item.library, location: item.home_location, barcode: item.barcode)}'".html_safe if !location_request_link.render? && item.circulates? && !item.request_link.render? %>>
            <span class="availability-icon-wrapper">
              <i class="availability-icon <%= item.status.availability_class %>"></i>
              <span data-available-text="<%= t('searchworks.availability.available') %>" data-unavailable-text="<%= t('searchworks.availability.unavailable') %>" class='status-text'>
                <%= item.status.status_text unless item.current_location && item.current_location.name.present? %>
              </span>
            </span>
            <span class="current-location">
              <% unless item.treat_current_location_as_home_location? %>
                <%= item.current_location.name %>
              <% end %>
            </span>
            <% if item.on_reserve? %>
              <%= item.loan_period %>
            <% end %>
            <% unless location_request_link.render? %>
              <span class="request-link">
                <%= render item.request_link %>
              </span>
            <% end %>
          </td>
        <% else %>
          <td></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
